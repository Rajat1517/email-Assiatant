{"version":3,"file":"index.js","sources":["../dist-src/core.js","../dist-src/index.js"],"sourcesContent":["import { isFunctionLike, visitEachChild, } from 'typescript';\r\n/**\r\n * Create a ReactRefresh transformer for TypeScript.\r\n *\r\n * This transformer should run in the before stage.\r\n *\r\n * This transformer requires TypeScript to be at least 4.0.\r\n */\r\nexport default function (opts = {}) {\r\n    const ts = opts.ts;\r\n    if (!ts)\r\n        throw new Error('Please provide typescript by options.ts');\r\n    {\r\n        const [major] = ts.version.split('.');\r\n        if (parseInt(major) < 4)\r\n            throw new Error('TypeScript should be at least 4.0');\r\n    }\r\n    return (context) => {\r\n        const { factory } = context;\r\n        const refreshReg = factory.createIdentifier(opts.refreshReg || '$RefreshReg$');\r\n        const refreshSig = factory.createIdentifier(opts.refreshSig || '$RefreshSig$');\r\n        return (file) => {\r\n            if (file.isDeclarationFile)\r\n                return file;\r\n            const containHooksLikeOrJSX = file.languageVariant === ts.LanguageVariant.JSX || file.text.includes('use');\r\n            if (!containHooksLikeOrJSX)\r\n                return file;\r\n            // TODO: change to scan comment?\r\n            const globalRequireForceRefresh = file.text.includes('@refresh reset');\r\n            const topLevelDeclaredName = new Set();\r\n            // Collect top level local declarations\r\n            for (const node of file.statements) {\r\n                if (ts.isFunctionDeclaration(node) && node.name)\r\n                    topLevelDeclaredName.add(node.name.text);\r\n                if (ts.isVariableStatement(node)) {\r\n                    for (const decl of node.declarationList.declarations) {\r\n                        if (ts.isIdentifier(decl.name)) {\r\n                            topLevelDeclaredName.add(decl.name.text);\r\n                        }\r\n                        // ? skip for deconstructing pattern\r\n                    }\r\n                }\r\n            }\r\n            // track all JSX usage and transform non-top level hooks\r\n            const { nextFile, usedAsJSXElement, hooksSignatureMap } = visitDeep(file, topLevelDeclaredName, globalRequireForceRefresh);\r\n            file = nextFile;\r\n            return updateStatements(file, (statements) => ts.visitLexicalEnvironment(statements, (node) => visitTopLevel(usedAsJSXElement, hooksSignatureMap, node), context));\r\n        };\r\n        // Only visit top level declaration to find possible components\r\n        function visitTopLevel(usedAsJSXElement, hooksSignatureMap, node) {\r\n            if (ts.isFunctionDeclaration(node)) {\r\n                if (!node.name || !node.body)\r\n                    return node;\r\n                return [node, ...registerComponent(node.name)];\r\n            }\r\n            else if (ts.isVariableStatement(node)) {\r\n                const deferredStatements = [];\r\n                const nextDeclarationList = ts.visitEachChild(node.declarationList, (declaration) => {\r\n                    if (!ts.isVariableDeclaration(declaration))\r\n                        return declaration;\r\n                    const init = declaration.initializer;\r\n                    // Not handle complex declaration. e.g. [a, b] = [() => ..., () => ...]\r\n                    // or declaration without initializer\r\n                    if (!ts.isIdentifier(declaration.name) || !init)\r\n                        return declaration;\r\n                    const declarationUsedAsJSX = usedAsJSXElement.has(declaration.name.text);\r\n                    if (declarationUsedAsJSX || isFunctionExpressionLikeOrFunctionDeclaration(init)) {\r\n                        if (!unwantedComponentLikeDefinition(init)) {\r\n                            deferredStatements.push(...registerComponent(declaration.name));\r\n                        }\r\n                        if (isFunctionExpressionLikeOrFunctionDeclaration(init) && hooksSignatureMap.has(init)) {\r\n                            /**\r\n                             * const Comp = () => <Comp />\r\n                             * const Comp2 = function () { return <Comp /> }\r\n                             *\r\n                             * Reserve the function name\r\n                             *\r\n                             * See https://tc39.es/ecma262/multipage/ecmascript-language-expressions.html#sec-assignment-operators-runtime-semantics-evaluation\r\n                             */\r\n                            // this is a workaround to https://github.com/Jack-Works/react-refresh-transformer/issues/8\r\n                            // I don't have time to refactor it yet.\r\n                            let oneShot = false;\r\n                            const sig = visitEachChild(hooksSignatureMap.get(init), (node) => oneShot\r\n                                ? node\r\n                                : isFunctionLike(node)\r\n                                    ? (oneShot = declaration.name)\r\n                                    : node, context);\r\n                            deferredStatements.push(factory.createExpressionStatement(sig));\r\n                        }\r\n                        return declaration;\r\n                    }\r\n                    if (isHigherOrderComponentLike(init)) {\r\n                        const { registers, call } = registerHigherOrderComponent(hooksSignatureMap, init, declaration.name.text);\r\n                        deferredStatements.push(...registers, ...registerComponent(declaration.name));\r\n                        return factory.updateVariableDeclaration(declaration, declaration.name, undefined, declaration.type, call);\r\n                    }\r\n                    return declaration;\r\n                }, context);\r\n                return [\r\n                    factory.updateVariableStatement(node, node.modifiers, nextDeclarationList),\r\n                    ...deferredStatements,\r\n                ];\r\n            }\r\n            else if (ts.isExportAssignment(node)) {\r\n                if (isHigherOrderComponentLike(node.expression)) {\r\n                    const { registers, call } = registerHigherOrderComponent(hooksSignatureMap, node.expression, '%default%');\r\n                    const temp = createTempVariable();\r\n                    return [\r\n                        factory.updateExportAssignment(node, node.decorators, node.modifiers, factory.createAssignment(temp, call)),\r\n                        createComponentRegisterCall(temp, '%default%'),\r\n                        ...registers,\r\n                    ];\r\n                }\r\n                else if (isFunctionExpressionLikeOrFunctionDeclaration(node.expression)) {\r\n                    const expr = hooksSignatureMap.get(node.expression);\r\n                    if (expr) {\r\n                        return factory.updateExportAssignment(node, node.decorators, node.modifiers, expr);\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        }\r\n        function registerComponent(name) {\r\n            if (!startsWithLowerCase(name.text)) {\r\n                const temp = createTempVariable();\r\n                // uniq = name\r\n                const assignment = factory.createAssignment(temp, name);\r\n                // $reg$(uniq, \"name\")\r\n                return [factory.createExpressionStatement(assignment), createComponentRegisterCall(temp, name.text)];\r\n            }\r\n            return [];\r\n        }\r\n        /**\r\n         * Please call isHOCLike before call this function\r\n         */\r\n        function registerHigherOrderComponent(hooksSignatureMap, callExpr, nameHint) {\r\n            // Recursive case, if it is x(y(...)), recursive with y(...) to get inner expr\r\n            const arg0 = callExpr.arguments[0];\r\n            if (ts.isCallExpression(arg0)) {\r\n                const tempVar = createTempVariable();\r\n                const nextNameHint = nameHint + '$' + printNode(callExpr.expression);\r\n                const { registers, call: innerResult } = registerHigherOrderComponent(hooksSignatureMap, arg0, nextNameHint);\r\n                return {\r\n                    call: factory.updateCallExpression(callExpr, callExpr.expression, void 0, [\r\n                        factory.createAssignment(tempVar, innerResult),\r\n                        ...callExpr.arguments.slice(1),\r\n                    ]),\r\n                    registers: registers.concat(createComponentRegisterCall(tempVar, nextNameHint)),\r\n                };\r\n            }\r\n            // Base case, it is x(function () {...}) or x(() => ...) or x(Identifier)\r\n            if (!isFunctionExpressionLikeOrFunctionDeclaration(arg0) && !ts.isIdentifier(arg0)) {\r\n                throw new Error('This is an error of react-refresh/typescript. Please report this problem: Call isHOC before register it');\r\n            }\r\n            if (ts.isIdentifier(arg0))\r\n                return { call: callExpr, registers: [] };\r\n            const tempVar = createTempVariable();\r\n            return {\r\n                call: factory.updateCallExpression(callExpr, callExpr.expression, void 0, [\r\n                    factory.createAssignment(tempVar, hooksSignatureMap.get(arg0) || arg0),\r\n                    ...callExpr.arguments.slice(1),\r\n                ]),\r\n                registers: [createComponentRegisterCall(tempVar, nameHint + '$' + printNode(callExpr.expression))],\r\n            };\r\n        }\r\n        function createTempVariable() {\r\n            return factory.createTempVariable(context.hoistVariableDeclaration, true);\r\n        }\r\n        /**\r\n         * ! This function does not consider variable shadowing !\r\n         */\r\n        function visitDeep(file, topLevelDeclaredName, globalRequireForceRefresh) {\r\n            const usedAsJSXElement = new Set();\r\n            const containingHooksOldMap = new Map();\r\n            const hooksSignatureMap = new Map();\r\n            function trackHooks(comp, call) {\r\n                const arr = containingHooksOldMap.get(comp) || [];\r\n                arr.push(call);\r\n                containingHooksOldMap.set(comp, arr);\r\n            }\r\n            function visitor(node) {\r\n                // Collect JSX create info\r\n                // <abc /> or <abc>\r\n                if (ts.isJsxOpeningLikeElement(node)) {\r\n                    const tag = node.tagName;\r\n                    if (ts.isIdentifier(tag) && !isIntrinsicElement(tag)) {\r\n                        const name = tag.text;\r\n                        if (topLevelDeclaredName.has(name))\r\n                            usedAsJSXElement.add(name);\r\n                    }\r\n                    // Not tracking other kinds of tagNames like <A.B /> or <A:B />\r\n                }\r\n                else if (isJSXConstructingCallExpr(node)) {\r\n                    const arg0 = node.arguments[0];\r\n                    if (arg0 && ts.isIdentifier(arg0)) {\r\n                        const name = arg0.text;\r\n                        if (topLevelDeclaredName.has(name))\r\n                            usedAsJSXElement.add(name);\r\n                    }\r\n                }\r\n                if (isReactHooksCall(node)) {\r\n                    const parent = findAncestor(node, isFunctionExpressionLikeOrFunctionDeclaration);\r\n                    if (parent)\r\n                        trackHooks(parent, node);\r\n                }\r\n                const oldNode = node;\r\n                // Collect hooks\r\n                node = ts.visitEachChild(node, visitor, context);\r\n                const hooksCalls = containingHooksOldMap.get(oldNode);\r\n                if (hooksCalls && isFunctionExpressionLikeOrFunctionDeclaration(node) && node.body) {\r\n                    const hooksTracker = createTempVariable();\r\n                    const createHooksTracker = factory.createExpressionStatement(factory.createBinaryExpression(hooksTracker, factory.createToken(ts.SyntaxKind.EqualsToken), factory.createCallExpression(refreshSig, undefined, [])));\r\n                    // @ts-ignore This is a private API.\r\n                    context.addInitializationStatement(createHooksTracker);\r\n                    const callTracker = factory.createCallExpression(hooksTracker, void 0, []);\r\n                    const nextBody = ts.isBlock(node.body)\r\n                        ? updateStatements(node.body, (r) => [factory.createExpressionStatement(callTracker), ...r])\r\n                        : factory.createComma(callTracker, node.body);\r\n                    const newFunction = updateBody(node, nextBody);\r\n                    const hooksSignature = hooksCallsToSignature(hooksCalls);\r\n                    const { force: forceRefresh, hooks: hooksArray } = needForceRefresh(hooksCalls);\r\n                    const requireForceRefresh = forceRefresh || globalRequireForceRefresh;\r\n                    if (ts.isFunctionDeclaration(newFunction)) {\r\n                        if (newFunction.name) {\r\n                            hooksSignatureMap.set(newFunction, createHooksRegisterCall(hooksTracker, newFunction.name, hooksSignature, requireForceRefresh, hooksArray));\r\n                        }\r\n                        node = newFunction;\r\n                    }\r\n                    else {\r\n                        const wrapped = createHooksRegisterCall(hooksTracker, newFunction, hooksSignature, requireForceRefresh, hooksArray);\r\n                        hooksSignatureMap.set(newFunction, wrapped);\r\n                        node = newFunction;\r\n                        // if it is an inner decl, we can update it safely\r\n                        if (findAncestor(oldNode.parent, ts.isFunctionLike))\r\n                            node = wrapped;\r\n                    }\r\n                }\r\n                return updateStatements(node, addSignatureReport);\r\n            }\r\n            function addSignatureReport(statements) {\r\n                const next = [];\r\n                for (const statement of statements) {\r\n                    // Don't want to do a type guard here cause it is safe\r\n                    const signatureReport = hooksSignatureMap.get(statement);\r\n                    next.push(statement);\r\n                    if (signatureReport)\r\n                        next.push(factory.createExpressionStatement(signatureReport));\r\n                }\r\n                return next;\r\n            }\r\n            const nextFile = updateStatements(ts.visitEachChild(file, visitor, context), addSignatureReport);\r\n            return {\r\n                nextFile,\r\n                usedAsJSXElement,\r\n                hooksSignatureMap,\r\n            };\r\n        }\r\n        function printNode(node) {\r\n            try {\r\n                return node.getText();\r\n            }\r\n            catch {\r\n                return '';\r\n            }\r\n        }\r\n        function hooksCallsToSignature(calls) {\r\n            const signature = calls\r\n                .map((x) => {\r\n                let assignTarget = '';\r\n                if (x.parent && ts.isVariableDeclaration(x.parent)) {\r\n                    assignTarget = printNode(x.parent.name);\r\n                }\r\n                let hooksName = printNode(x.expression);\r\n                let shouldCaptureArgs = 0; // bit-wise parameter position\r\n                if (ts.isPropertyAccessExpression(x.expression)) {\r\n                    const left = x.expression.expression;\r\n                    if (ts.isIdentifier(left) && left.text === 'React') {\r\n                        hooksName = printNode(x.expression.name);\r\n                    }\r\n                }\r\n                if (hooksName === 'useState')\r\n                    shouldCaptureArgs = 1 << 0;\r\n                else if (hooksName === 'useReducer')\r\n                    shouldCaptureArgs = 1 << 1;\r\n                const args = x.arguments.reduce((last, val, index) => {\r\n                    if ((1 << index) & shouldCaptureArgs) {\r\n                        if (last)\r\n                            last += ',';\r\n                        last += printNode(val);\r\n                    }\r\n                    return last;\r\n                }, '');\r\n                return `${hooksName}{${assignTarget}${args ? `(${args})` : ''}}`;\r\n            })\r\n                .join('\\n');\r\n            if (opts.emitFullSignatures !== true && opts.hashSignature) {\r\n                try {\r\n                    return opts.hashSignature(signature);\r\n                }\r\n                catch (e) { }\r\n            }\r\n            return signature;\r\n        }\r\n        function needForceRefresh(calls) {\r\n            const externalHooks = [];\r\n            return {\r\n                hooks: externalHooks,\r\n                force: calls.some((x) => {\r\n                    const ownerFunction = findAncestor(x, isFunctionExpressionLikeOrFunctionDeclaration);\r\n                    const callee = x.expression;\r\n                    if (!ownerFunction)\r\n                        return true;\r\n                    if (ts.isPropertyAccessExpression(callee)) {\r\n                        const left = callee.expression;\r\n                        if (ts.isIdentifier(left)) {\r\n                            if (left.text === 'React')\r\n                                return false;\r\n                            const hasDecl = hasDeclarationInScope(ownerFunction, left.text);\r\n                            if (hasDecl)\r\n                                externalHooks.push(callee);\r\n                            return !hasDecl;\r\n                        }\r\n                        return true;\r\n                    }\r\n                    else if (ts.isIdentifier(callee)) {\r\n                        if (isBuiltinHook(callee.text))\r\n                            return false;\r\n                        const hasDecl = hasDeclarationInScope(ownerFunction, callee.text);\r\n                        if (hasDecl)\r\n                            externalHooks.push(callee);\r\n                        return !hasDecl;\r\n                    }\r\n                    return true;\r\n                }),\r\n            };\r\n        }\r\n        /**\r\n         * @param instance The identifier of the sig instance\r\n         * @param component The binding component\r\n         * @param signature The signature of the function\r\n         * @param forceRefresh Does forceRefresh enabled?\r\n         * @param trackers A list of custom hooks references\r\n         */\r\n        function createHooksRegisterCall(instance, component, signature, forceRefresh, trackers) {\r\n            const args = [component];\r\n            if (signature.includes('\\n'))\r\n                args.push(factory.createNoSubstitutionTemplateLiteral(signature, signature));\r\n            else\r\n                args.push(factory.createStringLiteral(signature));\r\n            if (forceRefresh || trackers.length)\r\n                args.push(forceRefresh ? factory.createTrue() : factory.createFalse());\r\n            if (trackers.length)\r\n                args.push(factory.createArrowFunction(void 0, void 0, [], void 0, factory.createToken(ts.SyntaxKind.EqualsGreaterThanToken), factory.createArrayLiteralExpression(trackers)));\r\n            return factory.createCallExpression(instance, void 0, args);\r\n        }\r\n        function createComponentRegisterCall(id, name) {\r\n            return factory.createExpressionStatement(factory.createCallExpression(refreshReg, void 0, [id, factory.createStringLiteral(name)]));\r\n        }\r\n        function updateStatements(node, f) {\r\n            if (ts.isSourceFile(node)) {\r\n                const sf = factory.updateSourceFile(node, f(node.statements), node.isDeclarationFile, node.referencedFiles, node.typeReferenceDirectives, node.hasNoDefaultLib, node.libReferenceDirectives);\r\n                return sf;\r\n            }\r\n            if (ts.isCaseClause(node)) {\r\n                const caseClause = factory.updateCaseClause(node, node.expression, f(node.statements));\r\n                return caseClause;\r\n            }\r\n            if (ts.isDefaultClause(node)) {\r\n                const defaultClause = factory.updateDefaultClause(node, f(node.statements));\r\n                return defaultClause;\r\n            }\r\n            if (ts.isModuleBlock(node)) {\r\n                const modBlock = factory.updateModuleBlock(node, f(node.statements));\r\n                return modBlock;\r\n            }\r\n            if (ts.isBlock(node)) {\r\n                const block = factory.updateBlock(node, f(node.statements));\r\n                return block;\r\n            }\r\n            return node;\r\n        }\r\n        function updateBody(node, nextBody) {\r\n            if (ts.isFunctionDeclaration(node)) {\r\n                if (!ts.isBlock(nextBody))\r\n                    throw new TypeError();\r\n                return factory.updateFunctionDeclaration(node, node.decorators, node.modifiers, node.asteriskToken, node.name, node.typeParameters, node.parameters, node.type, nextBody);\r\n            }\r\n            else if (ts.isFunctionExpression(node)) {\r\n                if (!ts.isBlock(nextBody))\r\n                    throw new TypeError();\r\n                return factory.updateFunctionExpression(node, node.modifiers, node.asteriskToken, node.name, node.typeParameters, node.parameters, node.type, nextBody);\r\n            }\r\n            else if (ts.isArrowFunction(node)) {\r\n                return factory.updateArrowFunction(node, node.modifiers, node.typeParameters, node.parameters, node.type, node.equalsGreaterThanToken, nextBody);\r\n            }\r\n            return node;\r\n        }\r\n    };\r\n    function isBuiltinHook(hookName) {\r\n        switch (hookName) {\r\n            case 'useState':\r\n            case 'useReducer':\r\n            case 'useEffect':\r\n            case 'useLayoutEffect':\r\n            case 'useMemo':\r\n            case 'useCallback':\r\n            case 'useRef':\r\n            case 'useContext':\r\n            case 'useImperativeHandle':\r\n            case 'useDebugValue':\r\n            case 'useTransition':\r\n            case 'useDeferredValue':\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n    function hasDeclarationInScope(node, name) {\r\n        while (node) {\r\n            if (ts.isSourceFile(node) && hasDeclaration(node.statements, name))\r\n                return true;\r\n            if (ts.isBlock(node) && hasDeclaration(node.statements, name))\r\n                return true;\r\n            node = node.parent;\r\n        }\r\n        return false;\r\n    }\r\n    // This function does not consider uncommon and unrecommended practice like declare use var in a inner scope\r\n    function hasDeclaration(nodes, name) {\r\n        for (const node of nodes) {\r\n            if (ts.isVariableStatement(node)) {\r\n                for (const decl of node.declarationList.declarations) {\r\n                    // binding pattern not checked\r\n                    if (ts.isIdentifier(decl.name) && decl.name.text === name)\r\n                        return true;\r\n                }\r\n            }\r\n            else if (ts.isImportDeclaration(node)) {\r\n                const clause = node.importClause;\r\n                const defaultImport = clause && clause.name;\r\n                const namedImport = clause && clause.namedBindings;\r\n                if (defaultImport && defaultImport.text === name)\r\n                    return true;\r\n                if (namedImport && ts.isNamespaceImport(namedImport)) {\r\n                    if (namedImport.name.text === name)\r\n                        return true;\r\n                }\r\n                else if (namedImport && ts.isNamedImports(namedImport)) {\r\n                    const hasBinding = namedImport.elements.some((x) => x.name.text === name);\r\n                    if (hasBinding)\r\n                        return true;\r\n                }\r\n            }\r\n            else if (ts.isFunctionDeclaration(node)) {\r\n                if (!node.body)\r\n                    continue;\r\n                if (node.name && node.name.text === name)\r\n                    return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    function isIntrinsicElement(id) {\r\n        return id.text.includes('-') || startsWithLowerCase(id.text) || id.text.includes(':');\r\n    }\r\n    function isImportOrRequireLike(expr) {\r\n        if (!ts.isCallExpression(expr))\r\n            return false;\r\n        const callee = expr.expression;\r\n        if (callee.kind === ts.SyntaxKind.ImportKeyword)\r\n            return true;\r\n        if (ts.isIdentifier(callee) && callee.text.includes('require'))\r\n            return true;\r\n        return false;\r\n    }\r\n    function isReactHooksCall(expr) {\r\n        if (!ts.isCallExpression(expr))\r\n            return false;\r\n        const callee = expr.expression;\r\n        if (ts.isIdentifier(callee) && callee.text.startsWith('use'))\r\n            return true;\r\n        if (ts.isPropertyAccessExpression(callee) && callee.name.text.startsWith('use'))\r\n            return true;\r\n        return false;\r\n    }\r\n    function findAncestor(node, callback) {\r\n        while (node) {\r\n            const result = callback(node);\r\n            if (result === 'quit') {\r\n                return undefined;\r\n            }\r\n            else if (result) {\r\n                return node;\r\n            }\r\n            node = node.parent;\r\n        }\r\n        return undefined;\r\n    }\r\n    /**\r\n     * If it return true, don't track it even it is used as JSX component\r\n     */\r\n    function unwantedComponentLikeDefinition(expr) {\r\n        if (isImportOrRequireLike(expr))\r\n            return true;\r\n        // `const A = B.X` or `const A = X`\r\n        if (ts.isIdentifier(expr) || ts.isPropertyAccessExpression(expr))\r\n            return true;\r\n        if (ts.isConditionalExpression(expr))\r\n            return (unwantedComponentLikeDefinition(expr.condition) ||\r\n                unwantedComponentLikeDefinition(expr.whenFalse) ||\r\n                unwantedComponentLikeDefinition(expr.whenTrue));\r\n        return false;\r\n    }\r\n    function isHigherOrderComponentLike(outExpr) {\r\n        let expr = outExpr;\r\n        if (!ts.isCallExpression(outExpr))\r\n            return false;\r\n        while (ts.isCallExpression(expr) && !isImportOrRequireLike(expr)) {\r\n            const callee = expr.expression;\r\n            // x.y() or x()\r\n            const isValidCallee = ts.isPropertyAccessExpression(callee) || ts.isIdentifier(callee);\r\n            if (isValidCallee) {\r\n                expr = expr.arguments[0]; // check if arg is also a HOC\r\n                if (!expr)\r\n                    return false;\r\n            }\r\n            else\r\n                return false;\r\n        }\r\n        const isValidHOCArg = isFunctionExpressionLikeOrFunctionDeclaration(expr) ||\r\n            (ts.isIdentifier(expr) && !startsWithLowerCase(expr.text));\r\n        return isValidHOCArg;\r\n    }\r\n    function isFunctionExpressionLikeOrFunctionDeclaration(node) {\r\n        if (ts.isFunctionDeclaration(node))\r\n            return true;\r\n        if (ts.isArrowFunction(node))\r\n            return true;\r\n        if (ts.isFunctionExpression(node))\r\n            return true;\r\n        return false;\r\n    }\r\n    /**\r\n     * If the call expression seems like \"jsx(...)\" or \"xyz.jsx(...)\"\r\n     */\r\n    function isJSXConstructingCallExpr(call) {\r\n        if (!ts.isCallExpression(call))\r\n            return false;\r\n        const callee = call.expression;\r\n        let f = '';\r\n        if (ts.isIdentifier(callee))\r\n            f = callee.text;\r\n        if (ts.isPropertyAccessExpression(callee))\r\n            f = callee.name.text;\r\n        if (['createElement', 'jsx', 'jsxs', 'jsxDEV'].includes(f))\r\n            return true;\r\n        return false;\r\n    }\r\n}\r\nfunction startsWithLowerCase(str) {\r\n    return str[0].toLowerCase() === str[0];\r\n}\r\n","// Node wrapper\r\nimport core from './core';\r\nimport typescript from 'typescript';\r\nimport crypto from 'crypto';\r\nconst nodeWrapper = function (option = {}) {\r\n    return core({\r\n        ts: typescript,\r\n        hashSignature: (signature) => crypto.createHash('sha1').update(signature).digest('base64'),\r\n        ...option,\r\n    });\r\n};\r\n// Our build tool chain doesn't allow use to write export = nodeWrapper\r\nObject.assign(nodeWrapper, { default: nodeWrapper });\r\nmodule.exports = nodeWrapper;\r\nmodule.exports.__esModule = true;\r\n// Give it a correct typing\r\nexport default nodeWrapper;\r\n"],"names":["opts","ts","Error","major","version","split","parseInt","context","factory","refreshReg","createIdentifier","refreshSig","file","isDeclarationFile","containHooksLikeOrJSX","languageVariant","LanguageVariant","JSX","text","includes","globalRequireForceRefresh","topLevelDeclaredName","Set","node","statements","isFunctionDeclaration","name","add","isVariableStatement","decl","declarationList","declarations","isIdentifier","nextFile","usedAsJSXElement","hooksSignatureMap","visitDeep","updateStatements","visitLexicalEnvironment","visitTopLevel","body","registerComponent","deferredStatements","nextDeclarationList","visitEachChild","declaration","isVariableDeclaration","init","initializer","declarationUsedAsJSX","has","isFunctionExpressionLikeOrFunctionDeclaration","unwantedComponentLikeDefinition","push","oneShot","sig","get","isFunctionLike","createExpressionStatement","isHigherOrderComponentLike","registers","call","registerHigherOrderComponent","updateVariableDeclaration","undefined","type","updateVariableStatement","modifiers","isExportAssignment","expression","temp","createTempVariable","updateExportAssignment","decorators","createAssignment","createComponentRegisterCall","expr","startsWithLowerCase","assignment","callExpr","nameHint","arg0","arguments","isCallExpression","tempVar","nextNameHint","printNode","innerResult","updateCallExpression","slice","concat","hoistVariableDeclaration","containingHooksOldMap","Map","trackHooks","comp","arr","set","visitor","isJsxOpeningLikeElement","tag","tagName","isIntrinsicElement","isJSXConstructingCallExpr","isReactHooksCall","parent","findAncestor","oldNode","hooksCalls","hooksTracker","createHooksTracker","createBinaryExpression","createToken","SyntaxKind","EqualsToken","createCallExpression","addInitializationStatement","callTracker","nextBody","isBlock","r","createComma","newFunction","updateBody","hooksSignature","hooksCallsToSignature","force","forceRefresh","hooks","hooksArray","needForceRefresh","requireForceRefresh","createHooksRegisterCall","wrapped","addSignatureReport","next","statement","signatureReport","getText","calls","signature","map","x","assignTarget","hooksName","shouldCaptureArgs","isPropertyAccessExpression","left","args","reduce","last","val","index","join","emitFullSignatures","hashSignature","e","externalHooks","some","ownerFunction","callee","hasDecl","hasDeclarationInScope","isBuiltinHook","instance","component","trackers","createNoSubstitutionTemplateLiteral","createStringLiteral","length","createTrue","createFalse","createArrowFunction","EqualsGreaterThanToken","createArrayLiteralExpression","id","f","isSourceFile","sf","updateSourceFile","referencedFiles","typeReferenceDirectives","hasNoDefaultLib","libReferenceDirectives","isCaseClause","caseClause","updateCaseClause","isDefaultClause","defaultClause","updateDefaultClause","isModuleBlock","modBlock","updateModuleBlock","block","updateBlock","TypeError","updateFunctionDeclaration","asteriskToken","typeParameters","parameters","isFunctionExpression","updateFunctionExpression","isArrowFunction","updateArrowFunction","equalsGreaterThanToken","hookName","hasDeclaration","nodes","isImportDeclaration","clause","importClause","defaultImport","namedImport","namedBindings","isNamespaceImport","isNamedImports","hasBinding","elements","isImportOrRequireLike","kind","ImportKeyword","startsWith","callback","result","isConditionalExpression","condition","whenFalse","whenTrue","outExpr","isValidCallee","isValidHOCArg","str","toLowerCase","nodeWrapper","option","core","typescript","crypto","createHash","update","digest","Object","assign","default","module","exports","__esModule"],"mappings":"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"}